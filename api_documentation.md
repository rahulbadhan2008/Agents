# LLM Ops RAG API Documentation

This document provides detailed specifications for the available API endpoints in the LLM Ops RAG Pipeline.

## Base URL
`http://localhost:8000/api/v1`

## RAG Endpoints

### Execute RAG Query
Executes a multi-agent RAG workflow including retrieval, reranking, and synthesis.

- **URL**: `/rag/query`
- **Method**: `POST`
- **Authentication**: None (Add API Key in production)
- **Request Body**:
  ```json
  {
    "query": "What are the benefits of hybrid search?",
    "session_id": "session-123",
    "agent_id": "agent-default"
  }
  ```
- **Success Response (200 OK)**:
  ```json
  {
    "query": "What are the benefits of hybrid search?",
    "response": "Hybrid search combines keyword and vector search...",
    "context": {
      "bm25": [...],
      "vector": [...],
      "graph": [...]
    }
  }
  ```

---

## Agent Management Endpoints

### Create Tool
Define a new tool with custom backend logic.

- **URL**: `/agents/tools`
- **Method**: `POST`
- **Request Body**:
  ```json
  {
    "name": "calc_tax",
    "description": "Calculate tax for a given amount",
    "schema": {
        "type": "object",
        "properties": {
            "amount": {"type": "number"}
        },
        "required": ["amount"]
    },
    "code": "def calc_tax(amount):\n    return amount * 0.15"
  }
  ```

### Assign Tool to Agent
- **URL**: `/agents/{agent_id}/tools/{tool_id}`
- **Method**: `POST`

---

## MCP Server & Dynamic Tools
The system utilizes a custom **MCP Server** (`app/services/mcp_server.py`) that:
1. **Fetches Tools**: Loads specialized tools from the PostgreSQL database assigned to an agent.
2. **Registers Logic**: Dynamically executes Python code stored for each tool.
3. **Executes Tools**: Handles the execution of tool calls generated by the LLM during the LangGraph workflow.

---

## Technical Specifications
- **Framework**: FastAPI
- **Architecture**: MVC (Model-View-Controller)
- **Validation**: Pydantic v2
- **Persistence**: PostgreSQL (SQLAlchemy) & Redis
